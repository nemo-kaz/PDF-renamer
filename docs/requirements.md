# 要件文書

## 概要

PDF リネーミングツールは、指定されたディレクトリとそのサブディレクトリ内のすべての PDF ファイルを再帰的に検索し、各 PDF ファイルのタイトルプロパティに基づいてファイル名を自動的に変更する Groovy CLI コマンドです。このツールは、PDF ファイルの管理を効率化し、ファイル名とコンテンツの一貫性を保つことを目的としています。

## 要件

### 要件 1

**ユーザーストーリー:** ユーザーとして、ディレクトリを再帰的にスキャンしてPDFファイルを検索したい。これにより、ディレクトリツリー構造内のすべてのPDFファイルを処理できるようになる。

#### 受け入れ基準

1. コマンドが実行されたとき、システムは現在の作業ディレクトリからすべてのサブディレクトリを再帰的に走査する
2. 各ディレクトリに入ったとき、システムはそのディレクトリ内のすべてのファイルを調べる
3. ファイルを調べるとき、システムはファイル拡張子によってPDFファイルを識別する
4. ディレクトリを処理するとき、システムは見つかったすべてのファイルのフルパスリストを作成する
5. シンボリックリンクに遭遇したとき、システムはそれらを無視して処理を継続する
6. アクセス権限のないディレクトリに遭遇したとき、システムは適切なエラーメッセージを表示して処理を継続する

### 要件 2

**ユーザーストーリー:** ユーザーとして、すべてのリネーム操作を含む単一のGroovyスクリプトを生成したい。これにより、変更内容を確認し、制御された方法で実行できるようになる。

#### 受け入れ基準

1. ツールが開始されたとき、システムは現在のディレクトリに「renamePDFs.groovy」という名前のファイルを作成する
2. PDFファイルを処理するとき、システムは出力Groovyファイルにリネームコマンドを追記する
3. コマンドを生成するとき、システムはリネーム操作にFiles.move()メソッドを使用する
4. ファイルパスを書き込むとき、システムはエラーを防ぐためにパスを三重引用符（"""）で囲む

### 要件 3

**ユーザーストーリー:** ユーザーとして、PDFファイルをそのタイトルプロパティに基づいてリネームしたい。これにより、ファイル名が文書の実際の内容を反映するようになる。

#### 受け入れ基準

1. PDFファイルを処理するとき、システムはPDFメタデータからタイトルプロパティを読み取る
2. タイトルプロパティが有効なとき、システムはタイトルを新しいファイル名として使用するリネームコマンドを生成する
3. 新しいファイル名を生成するとき、システムはタイトルに「.pdf」拡張子を追加する
4. リネーム操作が生成されるとき、システムは古いファイル名と新しいファイル名を示すprintln文を含める

### 要件 4

**ユーザーストーリー:** ユーザーとして、特定のPDFファイルをリネームから除外したい。これにより、特定の命名パターンを持つファイルが変更されずに残るようになる。

#### 受け入れ基準

1. タイトルが「_」で始まるとき、システムはリネームコマンドを生成しない
2. タイトルが「~」で始まるとき、システムはリネームコマンドを生成しない
3. タイトルが「Untitled」で始まるとき、システムはリネームコマンドを生成しない
4. タイトルが空文字列のとき、システムはリネームコマンドを生成しない

### 要件 5

**ユーザーストーリー:** ユーザーとして、無効なWindowsファイル名文字を置換したい。これにより、生成されるファイル名がWindowsファイルシステムと互換性を持つようになる。

#### 受け入れ基準

1. タイトルに「:」が含まれるとき、システムはそれを「_」に置換する
2. タイトルに「"」が含まれるとき、システムはそれを「_」に置換する
3. タイトルに他のWindows無効文字が含まれるとき、システムはそれらを「_」に置換する
4. ファイル名をサニタイズするとき、システムは結果のファイル名がWindowsファイルシステムで有効であることを保証する

### 要件 6

**ユーザーストーリー:** ユーザーとして、リネーム操作を特定の形式で確認したい。これにより、どのような変更が行われるかを理解できるようになる。

#### 受け入れ基準

1. リネームコマンドを生成するとき、システムはPaths.get()を使用してパスオブジェクトを作成する
2. パスオブジェクトを作成するとき、システムはパス文字列でフォワードスラッシュを使用する
3. 出力を生成するとき、システムは次の形式に従う：def oldPath = Paths.get("path"), def newPath = Paths.get("path"), Files.move(oldPath, newPath)
4. リネーム操作を実行するとき、システムは「リネーム: ${oldPath} -> ${newPath}」を印刷する

### 要件 7

**ユーザーストーリー:** ユーザーとして、ツールがさまざまな技術的制約を処理できるようにしたい。これにより、異なる環境で確実に動作するようになる。

#### 受け入れ基準

1. ツールを実装するとき、システムはライブラリ依存関係とバージョン依存関係を最小限に抑える
2. コードを書くとき、システムは十分なコメントを付けて可読性と保守性を優先する
3. 例外やエラーケースに遭遇するとき、システムはそれらを適切に処理する
4. ファイルを処理するとき、システムはUTF-8、Shift-JIS、EUC-JPの文字エンコーディングをサポートする
5. 操作を処理するとき、システムは画面に進行状況情報を適切に表示する
6. 大量のファイルを処理するとき、システムは効率的に動作する



